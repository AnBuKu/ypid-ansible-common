#!/bin/bash

# Export ROLESPEC_TEST_SUITE_LOCATION as environment variables.

TEMPLATE_DIR="$( cd "$( dirname "${BASH_SOURCE[0]}" )/../template_role/" && pwd )"

if [ ! -d "docs" ]
then
    echo "You need to create the docs directory in the role." 1>&2
    exit 1
fi

cp -f "${ROLESPEC_TEST_SUITE_LOCATION}/sphinx-docs-template"/* ./docs/
test -e .gitignore || cp "${TEMPLATE_DIR}/.gitignore" .gitignore
cd docs || exit
test -d _static || mkdir -p _static
test -f ../defaults/main.yml && yaml2rst ../defaults/main.yml defaults.rst --strip-regex '\s*(:?\[{3}|\]{3})\d?$'
touch index.rst
sphinx-build -n -W -b html -d _build/doctrees . _build/html
